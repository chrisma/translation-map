<!DOCTYPE html>
<html>
<head>
  <title>Translate Map</title>
  <link rel="stylesheet" href="jquery-jvectormap-2.0.1.css" type="text/css" media="screen"/>
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>
  <script src="jquery-jvectormap-2.0.1.min.js"></script>
  <script src="jquery-jvectormap-europe-mill-en.js"></script>
  <script src="google_translate.js"></script>
  <style type="text/css">
    * {
      margin: 0;
    }
    input[type="text"] {
      position:absolute;
      top: 45px;
      left: 80px;
      font-size: 16px;
      box-shadow: 1px 2px 2px 1px #303030;
      padding: 5px;
      border: none;
    }
    input[type="text"]:focus {
      outline: 0; /*diable blue outline on focus*/
    }
  </style>
</head>
<body>
  <div id="map" style="width:100%; height: 900px;"></div>
  <input type="text" autofocus placeholder="Word to translate">
  <script>
    //https://cloud.google.com/translate/v2/using_rest#language-params
    var languageData = {
      'en': {countries:['gb'], name:'English'},
      'de': {countries:['de', 'at'], name:'German'},
      'fr': {countries:['fr'], name:'French'},
      'nl': {countries:['nl'], name:'Dutch'},
      'da': {countries:['dk'], name:'Danish'},
      'pl': {countries:['pl'], name:'Polish'},
      'cs': {countries:['cz'], name:'Czech'},
      'es': {countries:['es'], name:'Spanish'},
      'pt': {countries:['pt'], name:'Portuguese'},
      'it': {countries:['it'], name:'Italian'},
      'no': {countries:['no'], name:'Norwegian'},
      'sv': {countries:['se'], name:'Swedish'},
      'fi': {countries:['fi'], name:'Finnish'},
      'et': {countries:['ee'], name:'Estonia'},
      'lv': {countries:['lv'], name:'Latvian'},
      'lt': {countries:['lt'], name:'Lithuanian'},
      'be': {countries:['by'], name:'Belarusian'},
      'uk': {countries:['ua'], name:'Ukrainian'},
      'sk': {countries:['sk'], name:'Slovak'},
      'hu': {countries:['hu'], name:'Hungarian'},
      'ro': {countries:['ro','md'], name:'Romanian'},
      'bg': {countries:['bg'], name:'Bulgarian'},
      'el': {countries:['gr'], name:'Greek'},
      'sl': {countries:['si'], name:'Slovenian'},
      'hr': {countries:['hr'], name:'Croatian'},
      'sr': {countries:['rs'], name:'Serbian'},
      'sq': {countries:['al'], name:'Albanian'},
      'mk': {countries:['mk'], name:'Macedonian'},
      'tr': {countries:['tr'], name:'Turkish'},
      'ru': {countries:['ru'], name:'Russian'},
    }

    function languageName(countryCode) {
      for (var key in languageData) {
        var obj = languageData[key];
        if ( obj.countries.indexOf(countryCode) > -1 ) return obj.name
      }
    }

    var offsets = {
      'RU': [50,0],
      'NO': [-30,75],
      'FI': [0,50],
      'SE': [-40,60],
      'EE': [10,0],
      'ES': [-15,-20],
      'DK': [-32,0],
      'IT': [0,-10],
      'LV': [7,-4],
      'AT': [15,0],
      'DE': [0,-10],
      'UA': [0,-20],
      'MD': [0,-10],
      'BG': [-5,0],
      'GR': [-30,-20],
      'HR': [5,-18],
      'SI': [-1,-1],
      'PT': [-4,0],
      'FR': [0,-10],
      'AL': [-4,5],
      'GB': [23,60],
      'LT': [0,-5],
      'SK': [0,-3]
    }

    var mapParams = {
      container: $('#map'),
      map: 'europe_mill_en',
      // backgroundColor: '#003555',
      backgroundColor: '#1C6BA0',
      regionLabelStyle: {
        initial: {
          'font-family': 'sans-serif',
          'font-size': '14',
          'font-weight': 'bold',
          cursor: 'default',
          fill: 'black'
        }
      },
      labels: {
        regions: {
          render: function(code){
            //Persuade the map to draw a text element as region label
            //which can be filled later.
            return ' '
          },
          offsets: function(code){
            return offsets[code];
          }
        }
      },
      onRegionTipShow: function(event, tooltip, code){
        var name = languageName(code.toLowerCase());
        if ( name ) tooltip.html(tooltip.html()+'<br>(' + name + ')');
      }
    }

    function showTranslation(toCode, data) {
      var countries = languageData[toCode].countries;
      for (var key in countries) {
        var countryCode = countries[key];
        var label = $('text').filter('[data-code="' + countryCode.toUpperCase() + '"]');
        var text = data.translation;
        // if ( data.transliteration ) text += (' [' + data.transliteration + ']');
        label.text(text);
      }
    }

    function run(text){
      for (var languageCode in languageData) {
        showTranslation(languageCode, {translation: '...'});
        var result = googleTranslate(text, 'en', languageCode);
        //Curry, fix the first parameter
        result.done(showTranslation.bind(null, languageCode));
        result.fail(function(jqXHR, textStatus, errorThrown){
          console.log('ERROR:',textStatus, errorThrown);
        });
      }
    }

    var map;
    $(document).ready(function(){
      var $map = $('#map');
      map = new jvm.Map(mapParams);

      function adaptToWindow() {
        $map.height($(window).height());
        map.updateSize();
      }

      adaptToWindow();
      $(window).resize(adaptToWindow);

      // var URLhash = location.hash.replace('#', '');
      // if ( URLhash ) run(URLhash);
      // var ArtistAndSong = URLhash || randomPropertyName(cache);

      // $(window).on('hashchange',function(){
      //   window.location.reload();
      // });

      var word = "house";
      run(word);

    });
  </script>
</body>
</html>